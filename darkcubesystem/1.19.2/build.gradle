import java.nio.charset.StandardCharsets

plugins {
    id 'io.papermc.paperweight.userdev' version '1.4.0'
    id 'java-library'
}

dependencies {
    paperweightDevelopmentBundle('io.papermc.paper:dev-bundle:1.19.2-R0.1-SNAPSHOT')
    implementation project(path: parent.project('core').path, configuration: 'shadow')
    compileOnly libs.cloudnetDriver
}

java {
    toolchain.languageVersion.set(JavaLanguageVersion.of(17))
    withSourcesJar()
}

tasks {
    reobfJar {
        var targetFile = tasks.reobfJar.outputJar.getAsFile().get()
        outputs.file targetFile
        doLast {
            copy {
                from tasks.reobfJar.outputJar.getAsFile().get()
                into targetFile.getParentFile()
                rename { targetFile.getName() }
            }
        }
    }
}

tasks {
    assemble {
        dependsOn(reobfJar)
    }
    compileJava {
        options.release.set(17)
        options.encoding(StandardCharsets.UTF_8.name())
    }
}
